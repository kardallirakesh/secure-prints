<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecurePrint | Unified Portal</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --neon: #38bdf8; --bg: #050505; }
        body {
            margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg);
            background-image: radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%);
            height: 100vh; display: flex; justify-content: center; align-items: center; color: white;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 30px;
            padding: 40px; width: 380px; text-align: center; box-shadow: 0 0 40px rgba(0,0,0,0.5);
        }
        .switcher { display: flex; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 15px; margin-bottom: 25px; }
        .switcher button {
            flex: 1; padding: 12px; border: none; background: transparent;
            color: #888; cursor: pointer; border-radius: 10px; font-weight: bold;
        }
        .switcher button.active { background: rgba(56, 189, 248, 0.1); color: var(--neon); }
        .id-badge { font-size: 42px; font-weight: 900; text-shadow: 0 0 20px var(--neon); margin: 20px 0; font-family: monospace; letter-spacing: 5px; }
        input, .btn-main { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; font-size: 16px; border: 1px solid rgba(255,255,255,0.1); }
        input { background: rgba(255,255,255,0.05); color: white; text-align: center; }
        .btn-main { background: var(--neon); color: black; font-weight: bold; cursor: pointer; border: none; box-shadow: 0 0 20px rgba(56, 189, 248, 0.4); }
        .status { font-size: 10px; letter-spacing: 2px; color: var(--neon); text-transform: uppercase; margin-bottom: 15px; }
    </style>
</head>
<body>

    <div class="glass-card">
        <div class="switcher">
            <button id="sTab" onclick="setMode('sender')">I AM SENDING</button>
            <button id="rTab" onclick="setMode('receiver')" class="active">I AM PRINTING</button>
        </div>

        <div id="ui-receiver">
            <div class="status" id="r-status">INITIALIZING...</div>
            <p style="font-size: 0.8rem; color: #94a3b8;">Customer enters this code:</p>
            <div id="my-id" class="id-badge">----</div>
            
            <div id="file-ready" style="display:none">
                <p id="file-info" style="color:#4ade80; font-weight: bold; font-size: 0.9rem;"></p>
                <button class="btn-main" onclick="printAndWipe()">PRINT & SHRED DATA</button>
            </div>
        </div>

        <div id="ui-sender" style="display: none;">
            <div class="status" id="s-status">SECURE TUNNEL READY</div>
            <input type="text" id="targetCode" placeholder="ENTER 5-DIGIT CODE">
            <input type="file" id="fileInput" accept="application/pdf">
            <button class="btn-main" onclick="startTransfer()">PUSH TO PRINTER</button>
        </div>
    </div>

    <script>
        const peer = new Peer();
        let activeBlobUrl = null;

        function setMode(mode) {
            document.getElementById('ui-sender').style.display = mode === 'sender' ? 'block' : 'none';
            document.getElementById('ui-receiver').style.display = mode === 'receiver' ? 'block' : 'none';
            document.getElementById('sTab').className = mode === 'sender' ? 'active' : '';
            document.getElementById('rTab').className = mode === 'receiver' ? 'active' : '';
        }

        // --- RECEIVER LOGIC ---
        peer.on('open', (id) => {
            document.getElementById('my-id').innerText = id.substring(0, 5).toUpperCase();
            document.getElementById('r-status').innerText = "ONLINE & SECURE";
        });

        peer.on('connection', (conn) => {
            document.getElementById('r-status').innerText = "RECEIVING...";
            conn.on('data', (data) => {
                const blob = new Blob([data.file], { type: 'application/pdf' });
                activeBlobUrl = URL.createObjectURL(blob); // Load into RAM
                document.getElementById('file-info').innerText = "üìÑ " + data.name;
                document.getElementById('file-ready').style.display = 'block';
                document.getElementById('r-status').innerText = "DATA IN MEMORY";
            });
        });

        function printAndWipe() {
            const printWindow = window.open(activeBlobUrl, '_blank'); // Open RAM link
            if (printWindow) {
                printWindow.focus();
                const checkStatus = setInterval(() => {
                    if (printWindow.closed) {
                        clearInterval(checkStatus);
                        URL.revokeObjectURL(activeBlobUrl); // Shred the data
                        alert("SECURITY PROTOCOL: RAM Wiped. File erased from system memory.");
                        window.location.reload(); 
                    }
                }, 1000);
            }
        }

        // --- SENDER LOGIC ---
        async function startTransfer() {
            const code = document.getElementById('targetCode').value.trim().toLowerCase();
            const file = document.getElementById('fileInput').files[0];
            const status = document.getElementById('s-status');

            if (!code || !file) return alert("Enter code and select a PDF!");

            status.innerText = "ESTABLISHING TUNNEL...";
            const conn = peer.connect(code);

            conn.on('open', async () => {
                const buffer = await file.arrayBuffer();
                conn.send({ file: buffer, name: file.name }); // Direct P2P stream
                status.innerText = "‚úÖ SENT SUCCESSFULLY!";
            });
            
            conn.on('error', () => { status.innerText = "‚ùå ERROR: CODE NOT FOUND"; });
        }
    </script>
</body>
</html>